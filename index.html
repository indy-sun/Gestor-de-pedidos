<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gestor de Pedidos</title>
    <style>
        body {
            background-color: #E6E6FA; /* lil√°s claro */
            font-family: Arial, sans-serif;
            padding: 20px;
        }

        h1 {
            text-align: center;
            margin-bottom: 20px;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 10px;
        }

        th, td {
            border: 1px solid #ccc;
            padding: 8px;
            text-align: left;
        }

        th {
            background-color: #D8BFD8;
        }

        tr:nth-child(even) {
            background-color: #F8F8FF;
        }

        .aceitarBtn {
            background-color: #9370DB;
            color: white;
            border: none;
            padding: 5px 10px;
            font-size: 14px;
            border-radius: 4px;
            cursor: pointer;
        }
    </style>
</head>
<body>
    <h1>Gestor de Pedidos</h1>
    <table id="pedidosTable">
        <thead>
            <tr>
                <th>Loja</th>
                <th>Cliente</th>
                <th>Status</th> 
                <th>Hor√°rio do Pedido</th>
                <th>A√ß√£o</th>
            </tr>
        </thead>
        <tbody>
            <!-- Pedidos ser√£o inseridos aqui via JS -->
        </tbody>
    </table>

    <script>
        const WEBHOOK_PEDIDOS = 'https://n8n.cardapioweb.com/webhook/orders';
        const WEBHOOK_ACEITAR = 'https://n8n.cardapioweb.com/webhook/aceitar';
        const TOKEN_SUPABASE = 'Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6IndjZHRzd3J6bmp0YWNwcnNicHp2Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjE3MjY3MDAsImV4cCI6MjA3NzMwMjcwMH0.Gk6wIyFqMZQU7BD27eBLD7kAetwgwNCttbcoeTL6Nj0';

        async function carregarPedidos() {
            try {
                const response = await fetch(WEBHOOK_PEDIDOS, {
                    method: 'GET',
                    headers: {
                        'Authorization': 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6IndjZHRzd3J6bmp0YWNwcnNicHp2Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjE3MjY3MDAsImV4cCI6MjA3NzMwMjcwMH0.Gk6wIyFqMZQU7BD27eBLD7kAetwgwNCttbcoeTL6Nj0'
                    }
                });

                const pedidos = await response.json();
                const tbody = document.querySelector('#pedidosTable tbody');
                tbody.innerHTML = ''; // limpa a tabela

                pedidos.forEach(pedido => {
                      const tr = document.createElement("tr");
                    
                      const tdId = document.createElement("td");
                      tdId.textContent = pedido.name_company;
                      tr.appendChild(tdId);
                    
                      const tdCliente = document.createElement("td");
                      tdCliente.textContent = pedido.name_costumer;
                      tr.appendChild(tdCliente);
                    
                      const tdStatus = document.createElement("td");
                      tdStatus.textContent = pedido.status;
                      tr.appendChild(tdStatus);
                    
                      const tdData = document.createElement("td");
                      tdData.textContent = new Date(pedido.time).toLocaleString("pt-BR");
                      tr.appendChild(tdData);
                    
                      // üëâ aqui criamos a c√©lula de a√ß√µes
                      const tdAcoes = document.createElement("td");
                    
                      // üëâ se o status for CREATED, adiciona o bot√£o Aceitar
                      if (pedido.status && pedido.status.toUpperCase() === "CREATED") {
                        const botaoAceitar = document.createElement("button");
                        botaoAceitar.textContent = "Aceitar";
                        botaoAceitar.classList.add("aceitarBtn");
                        botaoAceitar.dataset.id = pedido.id;
                        tdAcoes.appendChild(botaoAceitar);
                      }
                    
                      tr.appendChild(tdAcoes); // üëâ adiciona a c√©lula √† linha
                      tbody.appendChild(tr);

                    }

            );
            } catch (err) {
                console.error('Erro ao carregar pedidos:', err);
            }
        }

        // Carregar pedidos ao abrir a p√°gina
        carregarPedidos();

        // Delega√ß√£o de eventos para lidar com m√∫ltiplos bot√µes Aceitar
        document.querySelector('#pedidosTable tbody').addEventListener('click', async (e) => {
            if (e.target.classList.contains('aceitarBtn')) {
                const pedidoId = e.target.dataset.id;
                
                try {
                    const response = await fetch(WEBHOOK_ACEITAR, {
                        method: 'POST'

                    if (response.ok) {
                        alert('Pedido aceito com sucesso!');
                        carregarPedidos(); // Recarrega a tabela para atualizar o status
                    } else {
                        alert('Erro ao aceitar pedido');
                    }
                } catch (err) {
                    console.error('Erro ao aceitar pedido:', err);
                }
            }
        });
    </script>
</body>
</html>













